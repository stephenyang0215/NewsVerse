{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  props: {\n    imageSrc: {\n      type: String,\n      required: true\n    }\n  },\n  data() {\n    return {\n      activeMode: null,\n      // 当前激活的模式: 'selectArea' 或 'markArea'\n      selectArea: null,\n      // 选择的区域\n      markedAreas: [],\n      // 标记区域\n      isDragging: false,\n      dragIndex: null,\n      // 当前拖动的区域索引\n      canvasContext: null,\n      image: null,\n      // 图片对象\n      scaleFactor: 1,\n      // 缩放比例\n      offsetX: 0,\n      // 画布偏移量\n      offsetY: 0,\n      // 画布偏移量\n      startX: 0,\n      // 起始点坐标\n      startY: 0 // 起始点坐标\n    };\n  },\n  mounted() {\n    const canvas = this.$refs.canvas;\n    this.canvasContext = canvas.getContext(\"2d\");\n\n    // 加载图片\n    this.image = new Image();\n    this.image.src = this.imageSrc;\n    this.image.onload = () => {\n      this.drawImage(); // 图片加载完成后绘制到 canvas 上\n    };\n  },\n  methods: {\n    drawImage() {\n      const ctx = this.canvasContext;\n      const canvas = this.$refs.canvas;\n\n      // 清空画布\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      // 绘制图片\n      ctx.drawImage(this.image, this.offsetX, this.offsetY, this.image.width * this.scaleFactor, this.image.height * this.scaleFactor);\n\n      // 绘制选择区域\n      if (this.selectArea) {\n        ctx.save();\n        ctx.globalAlpha = 0.3;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n        ctx.fillRect(0, 0, canvas.width, canvas.height); // 画一个遮罩层\n        ctx.clearRect(this.selectArea.x, this.selectArea.y, this.selectArea.width, this.selectArea.height); // 清除选择区域内部\n        ctx.restore();\n        ctx.strokeStyle = \"blue\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(this.selectArea.x, this.selectArea.y, this.selectArea.width, this.selectArea.height); // 绘制选择区域的边框\n      }\n\n      // 绘制标记区域\n      for (const mark of this.markedAreas) {\n        ctx.strokeStyle = \"red\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(mark.x, mark.y, mark.width, mark.height);\n      }\n    },\n    onMouseDown(e) {\n      if (this.activeMode === \"selectArea\") {\n        this.startX = e.offsetX;\n        this.startY = e.offsetY;\n        this.isDragging = true;\n        this.selectArea = {\n          x: this.startX,\n          y: this.startY,\n          width: 0,\n          height: 0\n        };\n      } else if (this.activeMode === \"markArea\") {\n        for (const [index, mark] of this.markedAreas.entries()) {\n          if (this.isInsideArea(e.offsetX, e.offsetY, mark)) {\n            this.isDragging = true;\n            this.dragIndex = index;\n            return;\n          }\n        }\n      }\n    },\n    onMouseMove(e) {\n      if (this.isDragging) {\n        if (this.activeMode === \"selectArea\" && this.selectArea) {\n          const width = e.offsetX - this.startX;\n          const height = e.offsetY - this.startY;\n          this.selectArea.width = width;\n          this.selectArea.height = height;\n        } else if (this.activeMode === \"markArea\" && this.dragIndex !== null) {\n          const mark = this.markedAreas[this.dragIndex];\n          mark.x = e.offsetX - mark.width / 2;\n          mark.y = e.offsetY - mark.height / 2;\n        }\n        this.drawImage();\n      }\n    },\n    onMouseUp() {\n      if (this.isDragging) {\n        if (this.activeMode === \"selectArea\" && this.selectArea) {\n          // 完成选择区域\n          this.selectArea.width = Math.abs(this.selectArea.width);\n          this.selectArea.height = Math.abs(this.selectArea.height);\n        } else if (this.activeMode === \"markArea\" && this.selectArea) {\n          // 将选择区域作为标记区域\n          if (!this.isOverlapping(this.selectArea)) {\n            this.markedAreas.push({\n              ...this.selectArea\n            });\n          }\n        }\n        this.isDragging = false;\n        this.drawImage();\n      }\n    },\n    isInsideArea(x, y, area) {\n      return x >= area.x && x <= area.x + area.width && y >= area.y && y <= area.y + area.height;\n    },\n    isOverlapping(area) {\n      for (const mark of this.markedAreas) {\n        if (area.x < mark.x + mark.width && area.x + area.width > mark.x && area.y < mark.y + mark.height && area.y + area.height > mark.y) {\n          return true; // 有重叠\n        }\n      }\n      return false; // 没有重叠\n    },\n    saveData() {\n      const data = {\n        selectArea: this.selectArea,\n        marks: this.markedAreas\n      };\n      console.log(\"Saved data:\", data);\n      // 在这里发送数据到后端，使用 API 保存\n      // axios.post('/api/save', data);\n    }\n  }\n};","map":{"version":3,"names":["props","imageSrc","type","String","required","data","activeMode","selectArea","markedAreas","isDragging","dragIndex","canvasContext","image","scaleFactor","offsetX","offsetY","startX","startY","mounted","canvas","$refs","getContext","Image","src","onload","drawImage","methods","ctx","clearRect","width","height","save","globalAlpha","fillStyle","fillRect","x","y","restore","strokeStyle","lineWidth","strokeRect","mark","onMouseDown","e","index","entries","isInsideArea","onMouseMove","onMouseUp","Math","abs","isOverlapping","push","area","saveData","marks","console","log"],"sources":["src/components/ImageSelection.vue"],"sourcesContent":["<template>\n  <div class=\"canvas-container\">\n    <canvas\n      ref=\"canvas\"\n      width=\"800\"\n      height=\"600\"\n      @mousedown=\"onMouseDown\"\n      @mousemove=\"onMouseMove\"\n      @mouseup=\"onMouseUp\"\n    ></canvas>\n\n    <!-- 控制开关 -->\n    <div class=\"controls\">\n      <label>\n        <input type=\"radio\" v-model=\"activeMode\" value=\"selectArea\" />\n        选择可操作区域\n      </label>\n      <label>\n        <input type=\"radio\" v-model=\"activeMode\" value=\"markArea\" />\n        选择标记区域\n      </label>\n      <button @click=\"saveData\">保存</button>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    imageSrc: {\n      type: String,\n      required: true,\n    },\n  },\n  data() {\n    return {\n      activeMode: null, // 当前激活的模式: 'selectArea' 或 'markArea'\n      selectArea: null, // 选择的区域\n      markedAreas: [], // 标记区域\n      isDragging: false,\n      dragIndex: null, // 当前拖动的区域索引\n      canvasContext: null,\n      image: null, // 图片对象\n      scaleFactor: 1, // 缩放比例\n      offsetX: 0, // 画布偏移量\n      offsetY: 0, // 画布偏移量\n      startX: 0, // 起始点坐标\n      startY: 0, // 起始点坐标\n    };\n  },\n  mounted() {\n    const canvas = this.$refs.canvas;\n    this.canvasContext = canvas.getContext(\"2d\");\n\n    // 加载图片\n    this.image = new Image();\n    this.image.src = this.imageSrc;\n    this.image.onload = () => {\n      this.drawImage(); // 图片加载完成后绘制到 canvas 上\n    };\n  },\n  methods: {\n    drawImage() {\n      const ctx = this.canvasContext;\n      const canvas = this.$refs.canvas;\n\n      // 清空画布\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      // 绘制图片\n      ctx.drawImage(\n        this.image,\n        this.offsetX,\n        this.offsetY,\n        this.image.width * this.scaleFactor,\n        this.image.height * this.scaleFactor\n      );\n\n      // 绘制选择区域\n      if (this.selectArea) {\n        ctx.save();\n        ctx.globalAlpha = 0.3;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.5)\";\n        ctx.fillRect(0, 0, canvas.width, canvas.height); // 画一个遮罩层\n        ctx.clearRect(\n          this.selectArea.x,\n          this.selectArea.y,\n          this.selectArea.width,\n          this.selectArea.height\n        ); // 清除选择区域内部\n        ctx.restore();\n\n        ctx.strokeStyle = \"blue\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(\n          this.selectArea.x,\n          this.selectArea.y,\n          this.selectArea.width,\n          this.selectArea.height\n        ); // 绘制选择区域的边框\n      }\n\n      // 绘制标记区域\n      for (const mark of this.markedAreas) {\n        ctx.strokeStyle = \"red\";\n        ctx.lineWidth = 2;\n        ctx.strokeRect(mark.x, mark.y, mark.width, mark.height);\n      }\n    },\n    onMouseDown(e) {\n      if (this.activeMode === \"selectArea\") {\n        this.startX = e.offsetX;\n        this.startY = e.offsetY;\n        this.isDragging = true;\n        this.selectArea = {\n          x: this.startX,\n          y: this.startY,\n          width: 0,\n          height: 0,\n        };\n      } else if (this.activeMode === \"markArea\") {\n        for (const [index, mark] of this.markedAreas.entries()) {\n          if (this.isInsideArea(e.offsetX, e.offsetY, mark)) {\n            this.isDragging = true;\n            this.dragIndex = index;\n            return;\n          }\n        }\n      }\n    },\n    onMouseMove(e) {\n      if (this.isDragging) {\n        if (this.activeMode === \"selectArea\" && this.selectArea) {\n          const width = e.offsetX - this.startX;\n          const height = e.offsetY - this.startY;\n          this.selectArea.width = width;\n          this.selectArea.height = height;\n        } else if (this.activeMode === \"markArea\" && this.dragIndex !== null) {\n          const mark = this.markedAreas[this.dragIndex];\n          mark.x = e.offsetX - mark.width / 2;\n          mark.y = e.offsetY - mark.height / 2;\n        }\n        this.drawImage();\n      }\n    },\n    onMouseUp() {\n      if (this.isDragging) {\n        if (this.activeMode === \"selectArea\" && this.selectArea) {\n          // 完成选择区域\n          this.selectArea.width = Math.abs(this.selectArea.width);\n          this.selectArea.height = Math.abs(this.selectArea.height);\n        } else if (this.activeMode === \"markArea\" && this.selectArea) {\n          // 将选择区域作为标记区域\n          if (!this.isOverlapping(this.selectArea)) {\n            this.markedAreas.push({ ...this.selectArea });\n          }\n        }\n        this.isDragging = false;\n        this.drawImage();\n      }\n    },\n    isInsideArea(x, y, area) {\n      return (\n        x >= area.x &&\n        x <= area.x + area.width &&\n        y >= area.y &&\n        y <= area.y + area.height\n      );\n    },\n    isOverlapping(area) {\n      for (const mark of this.markedAreas) {\n        if (\n          area.x < mark.x + mark.width &&\n          area.x + area.width > mark.x &&\n          area.y < mark.y + mark.height &&\n          area.y + area.height > mark.y\n        ) {\n          return true; // 有重叠\n        }\n      }\n      return false; // 没有重叠\n    },\n    saveData() {\n      const data = {\n        selectArea: this.selectArea,\n        marks: this.markedAreas,\n      };\n      console.log(\"Saved data:\", data);\n      // 在这里发送数据到后端，使用 API 保存\n      // axios.post('/api/save', data);\n    },\n  },\n};\n</script>\n\n<style scoped>\n.canvas-container {\n  position: relative;\n}\n\ncanvas {\n  border: 1px solid #ccc;\n}\n\n.controls {\n  margin-top: 10px;\n}\n\nbutton {\n  margin-left: 10px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}