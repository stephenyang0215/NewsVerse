{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  props: {\n    imageUrl: {\n      type: String,\n      required: true\n    },\n    initialSelectedAreas: {\n      type: Array,\n      default: () => []\n    }\n  },\n  data() {\n    return {\n      image: null,\n      // 存储图片对象\n      canvas: null,\n      // canvas 实例\n      ctx: null,\n      // canvas 上下文\n      isSelecting: false,\n      // 是否在选择区域\n      selectionStart: {\n        x: 0,\n        y: 0\n      },\n      // 选择框开始位置\n      selectionEnd: {\n        x: 0,\n        y: 0\n      },\n      // 选择框结束位置\n      selectedAreas: this.initialSelectedAreas // 存储选中区域\n    };\n  },\n  mounted() {\n    this.ctx = this.$refs.canvas.getContext(\"2d\");\n    this.image.src = this.imageSrc || \"\"; // 可以通过props传入图片路径\n    this.image.onload = this.onImageLoad;\n  },\n  methods: {\n    onImageLoad() {\n      this.canvasWidth = this.image.width;\n      this.canvasHeight = this.image.height;\n      this.ctx.drawImage(this.image, 0, 0); // 绘制图片到画布\n    },\n    drawImage() {\n      if (this.image) {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); // 清除画布\n        this.ctx.drawImage(this.image, 0, 0, this.canvas.width, this.canvas.height); // 绘制图片\n\n        // 绘制已选择的区域\n        this.selectedAreas.forEach(area => {\n          this.ctx.fillStyle = \"rgba(0, 0, 255, 0.3)\";\n          this.ctx.fillRect(area.x1, area.y1, area.x2 - area.x1, area.y2 - area.y1);\n          this.ctx.strokeStyle = \"rgba(0, 0, 255, 0.5)\";\n          this.ctx.lineWidth = 2;\n          this.ctx.strokeRect(area.x1, area.y1, area.x2 - area.x1, area.y2 - area.y1);\n        });\n\n        // 如果正在选择区域，则绘制当前的选择框\n        if (this.isSelecting) {\n          const width = Math.abs(this.selectionEnd.x - this.selectionStart.x);\n          const height = Math.abs(this.selectionEnd.y - this.selectionStart.y);\n          const left = Math.min(this.selectionStart.x, this.selectionEnd.x);\n          const top = Math.min(this.selectionStart.y, this.selectionEnd.y);\n          this.ctx.fillStyle = \"rgba(0, 0, 255, 0.3)\";\n          this.ctx.fillRect(left, top, width, height);\n          this.ctx.strokeStyle = \"rgba(0, 0, 255, 0.5)\";\n          this.ctx.lineWidth = 2;\n          this.ctx.strokeRect(left, top, width, height);\n        }\n      }\n    },\n    onMouseDown(event) {\n      const {\n        offsetX,\n        offsetY\n      } = event;\n      this.isSelecting = true;\n      this.selectionStart = {\n        x: offsetX,\n        y: offsetY\n      };\n      this.selectionEnd = {\n        x: offsetX,\n        y: offsetY\n      };\n    },\n    onMouseUp() {\n      if (this.isSelecting) {\n        const area = {\n          x1: Math.min(this.selectionStart.x, this.selectionEnd.x),\n          y1: Math.min(this.selectionStart.y, this.selectionEnd.y),\n          x2: Math.max(this.selectionStart.x, this.selectionEnd.x),\n          y2: Math.max(this.selectionStart.y, this.selectionEnd.y)\n        };\n        this.selectedAreas.push(area);\n        this.isSelecting = false;\n        this.sendAreasToBackend(); // 将区域信息发送到后端\n      }\n    },\n    onMouseMove(event) {\n      if (this.isSelecting) {\n        this.selectionEnd = {\n          x: event.offsetX,\n          y: event.offsetY\n        };\n        this.drawImage(); // 重新绘制图片和选择框\n      }\n    },\n    onMouseOut() {\n      if (this.isSelecting) {\n        this.isSelecting = false;\n        this.drawImage(); // 重新绘制图片，移除选择框\n      }\n    },\n    sendAreasToBackend() {\n      // 将选中的区域信息发送到后端\n      this.$axios.post(\"/api/save-areas\", {\n        areas: this.selectedAreas\n      }).then(response => {\n        console.log(\"Areas saved successfully:\", response);\n      }).catch(error => {\n        console.error(\"Failed to save areas:\", error);\n      });\n    }\n  },\n  watch: {\n    selectedAreas(newValue) {\n      // 当 selectedAreas 更新时，将数据存储在本地，或者发送给后端\n      localStorage.setItem(\"selectedAreas\", JSON.stringify(newValue));\n      this.drawImage(); // 更新选择区域\n    }\n  },\n  created() {\n    const savedAreas = localStorage.getItem(\"selectedAreas\");\n    if (savedAreas) {\n      this.selectedAreas = JSON.parse(savedAreas);\n    }\n  }\n};","map":{"version":3,"names":["props","imageUrl","type","String","required","initialSelectedAreas","Array","default","data","image","canvas","ctx","isSelecting","selectionStart","x","y","selectionEnd","selectedAreas","mounted","$refs","getContext","src","imageSrc","onload","onImageLoad","methods","canvasWidth","width","canvasHeight","height","drawImage","clearRect","forEach","area","fillStyle","fillRect","x1","y1","x2","y2","strokeStyle","lineWidth","strokeRect","Math","abs","left","min","top","onMouseDown","event","offsetX","offsetY","onMouseUp","max","push","sendAreasToBackend","onMouseMove","onMouseOut","$axios","post","areas","then","response","console","log","catch","error","watch","newValue","localStorage","setItem","JSON","stringify","created","savedAreas","getItem","parse"],"sources":["src/components/ImageSelection.vue"],"sourcesContent":["<template>\n  <div class=\"canvas-container\">\n    <canvas\n      ref=\"canvas\"\n      @mousedown=\"onMouseDown\"\n      @mousemove=\"onMouseMove\"\n      @mouseup=\"onMouseUp\"\n      @mouseout=\"onMouseOut\"\n    ></canvas>\n  </div>\n</template>\n\n<script>\nexport default {\n  props: {\n    imageUrl: {\n      type: String,\n      required: true,\n    },\n    initialSelectedAreas: {\n      type: Array,\n      default: () => [],\n    },\n  },\n  data() {\n    return {\n      image: null, // 存储图片对象\n      canvas: null, // canvas 实例\n      ctx: null, // canvas 上下文\n      isSelecting: false, // 是否在选择区域\n      selectionStart: { x: 0, y: 0 }, // 选择框开始位置\n      selectionEnd: { x: 0, y: 0 }, // 选择框结束位置\n      selectedAreas: this.initialSelectedAreas, // 存储选中区域\n    };\n  },\n  mounted() {\n    this.ctx = this.$refs.canvas.getContext(\"2d\");\n    this.image.src = this.imageSrc || \"\"; // 可以通过props传入图片路径\n    this.image.onload = this.onImageLoad;\n  },\n  methods: {\n    onImageLoad() {\n      this.canvasWidth = this.image.width;\n      this.canvasHeight = this.image.height;\n      this.ctx.drawImage(this.image, 0, 0); // 绘制图片到画布\n    },\n\n    drawImage() {\n      if (this.image) {\n        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height); // 清除画布\n        this.ctx.drawImage(\n          this.image,\n          0,\n          0,\n          this.canvas.width,\n          this.canvas.height\n        ); // 绘制图片\n\n        // 绘制已选择的区域\n        this.selectedAreas.forEach((area) => {\n          this.ctx.fillStyle = \"rgba(0, 0, 255, 0.3)\";\n          this.ctx.fillRect(\n            area.x1,\n            area.y1,\n            area.x2 - area.x1,\n            area.y2 - area.y1\n          );\n          this.ctx.strokeStyle = \"rgba(0, 0, 255, 0.5)\";\n          this.ctx.lineWidth = 2;\n          this.ctx.strokeRect(\n            area.x1,\n            area.y1,\n            area.x2 - area.x1,\n            area.y2 - area.y1\n          );\n        });\n\n        // 如果正在选择区域，则绘制当前的选择框\n        if (this.isSelecting) {\n          const width = Math.abs(this.selectionEnd.x - this.selectionStart.x);\n          const height = Math.abs(this.selectionEnd.y - this.selectionStart.y);\n          const left = Math.min(this.selectionStart.x, this.selectionEnd.x);\n          const top = Math.min(this.selectionStart.y, this.selectionEnd.y);\n\n          this.ctx.fillStyle = \"rgba(0, 0, 255, 0.3)\";\n          this.ctx.fillRect(left, top, width, height);\n          this.ctx.strokeStyle = \"rgba(0, 0, 255, 0.5)\";\n          this.ctx.lineWidth = 2;\n          this.ctx.strokeRect(left, top, width, height);\n        }\n      }\n    },\n\n    onMouseDown(event) {\n      const { offsetX, offsetY } = event;\n      this.isSelecting = true;\n      this.selectionStart = { x: offsetX, y: offsetY };\n      this.selectionEnd = { x: offsetX, y: offsetY };\n    },\n\n    onMouseUp() {\n      if (this.isSelecting) {\n        const area = {\n          x1: Math.min(this.selectionStart.x, this.selectionEnd.x),\n          y1: Math.min(this.selectionStart.y, this.selectionEnd.y),\n          x2: Math.max(this.selectionStart.x, this.selectionEnd.x),\n          y2: Math.max(this.selectionStart.y, this.selectionEnd.y),\n        };\n        this.selectedAreas.push(area);\n        this.isSelecting = false;\n        this.sendAreasToBackend(); // 将区域信息发送到后端\n      }\n    },\n\n    onMouseMove(event) {\n      if (this.isSelecting) {\n        this.selectionEnd = { x: event.offsetX, y: event.offsetY };\n        this.drawImage(); // 重新绘制图片和选择框\n      }\n    },\n\n    onMouseOut() {\n      if (this.isSelecting) {\n        this.isSelecting = false;\n        this.drawImage(); // 重新绘制图片，移除选择框\n      }\n    },\n\n    sendAreasToBackend() {\n      // 将选中的区域信息发送到后端\n      this.$axios\n        .post(\"/api/save-areas\", { areas: this.selectedAreas })\n        .then((response) => {\n          console.log(\"Areas saved successfully:\", response);\n        })\n        .catch((error) => {\n          console.error(\"Failed to save areas:\", error);\n        });\n    },\n  },\n\n  watch: {\n    selectedAreas(newValue) {\n      // 当 selectedAreas 更新时，将数据存储在本地，或者发送给后端\n      localStorage.setItem(\"selectedAreas\", JSON.stringify(newValue));\n      this.drawImage(); // 更新选择区域\n    },\n  },\n\n  created() {\n    const savedAreas = localStorage.getItem(\"selectedAreas\");\n    if (savedAreas) {\n      this.selectedAreas = JSON.parse(savedAreas);\n    }\n  },\n};\n</script>\n\n<style scoped>\n.canvas-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n}\n\ncanvas {\n  border: 1px solid #ccc;\n  cursor: crosshair;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}